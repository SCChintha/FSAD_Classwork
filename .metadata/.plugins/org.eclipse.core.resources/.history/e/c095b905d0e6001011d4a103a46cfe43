package com.skill;

import java.sql.*;
import java.util.Scanner;

public class ProductCRUD {

    static String url = "jdbc:mysql://localhost:3306/skill2";
    static String user = "root";
    static String password = "Saich@2889";

    public static void main(String[] args) {

        createTable();   // TABLE CREATION

        Scanner sc = new Scanner(System.in);
        int choice;

        do {
            System.out.println("\n------ PRODUCT MENU ------");
            System.out.println("1. Insert Product");
            System.out.println("2. View Products");
            System.out.println("3. View Product by ID");
            System.out.println("4. Update Product Price/Quantity");
            System.out.println("5. Delete Product");
            System.out.println("6. Exit");
            System.out.print("Enter choice: ");
            choice = sc.nextInt();

            switch (choice) {
                case 1 -> insertProduct();
                case 2 -> viewProducts();
                case 3 -> viewProductById();
                case 4 -> updateProduct();
                case 5 -> deleteProduct();
                case 6 -> System.out.println("Exiting...");
                default -> System.out.println("Invalid choice!");
            }
        } while (choice != 6);
    }

    // ================= TABLE CREATION =================
    static void createTable() {
        try (Connection con = DriverManager.getConnection(url, user, password);
             Statement st = con.createStatement()) {

            String productTable = """
                    CREATE TABLE IF NOT EXISTS product (
                        product_id INT PRIMARY KEY,
                        name VARCHAR(50),
                        description VARCHAR(200),
                        price DOUBLE,
                        quantity INT
                    )
                    """;

            st.execute(productTable);
            System.out.println("Product table created or already exists.");

        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    // ================= CREATE =================
    static void insertProduct() {
        try (Connection con = DriverManager.getConnection(url, user, password)) {

            String sql = "INSERT INTO product VALUES (?, ?, ?, ?, ?)";
            PreparedStatement ps = con.prepareStatement(sql);
            Scanner sc = new Scanner(System.in);

            System.out.print("Enter Product ID: ");
            ps.setInt(1, sc.nextInt());

            System.out.print("Enter Product Name: ");
            ps.setString(2, sc.next());

            System.out.print("Enter Description: ");
            ps.setString(3, sc.next());

            System.out.print("Enter Price: ");
            ps.setDouble(4, sc.nextDouble());

            System.out.print("Enter Quantity: ");
            ps.setInt(5, sc.nextInt());

            ps.executeUpdate();
            System.out.println("Product inserted successfully!");

        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    // ================= READ ALL =================
    static void viewProducts() {
        try (Connection con = DriverManager.getConnection(url, user, password)) {

            String sql = "SELECT * FROM product";
            PreparedStatement ps = con.prepareStatement(sql);
            ResultSet rs = ps.executeQuery();

            System.out.println("\nID  Name  Desc  Price  Qty");
            while (rs.next()) {
                System.out.println(
                        rs.getInt(1) + "  " +
                        rs.getString(2) + "  " +
                        rs.getString(3) + "  " +
                        rs.getDouble(4) + "  " +
                        rs.getInt(5)
                );
            }

        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    // ================= READ BY ID =================
    static void viewProductById() {
        try (Connection con = DriverManager.getConnection(url, user, password)) {

            String sql = "SELECT * FROM product WHERE product_id=?";
            PreparedStatement ps = con.prepareStatement(sql);
            Scanner sc = new Scanner(System.in);

            System.out.print("Enter Product ID: ");
            ps.setInt(1, sc.nextInt());

            ResultSet rs = ps.executeQuery();

            if (rs.next()) {
                System.out.println("\nProduct Details:");
                System.out.println("ID: " + rs.getInt(1));
                System.out.println("Name: " + rs.getString(2));
                System.out.println("Description: " + rs.getString(3));
                System.out.println("Price: " + rs.getDouble(4));
                System.out.println("Quantity: " + rs.getInt(5));
            } else {
                System.out.println("Product not found!");
            }

        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    // ================= UPDATE =================
    static void updateProduct() {
        try (Connection con = DriverManager.getConnection(url, user, password)) {

            String sql = "UPDATE product SET price=?, quantity=? WHERE product_id=?";
            PreparedStatement ps = con.prepareStatement(sql);
            Scanner sc = new Scanner(System.in);

            System.out.print("Enter Product ID: ");
            ps.setInt(3, sc.nextInt());

            System.out.print("Enter New Price: ");
            ps.setDouble(1, sc.nextDouble());

            System.out.print("Enter New Quantity: ");
            ps.setInt(2, sc.nextInt());

            ps.executeUpdate();
            System.out.println("Product updated successfully!");

        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    // ================= DELETE =================
    static void deleteProduct() {
        try (Connection con = DriverManager.getConnection(url, user, password)) {

            String sql = "DELETE FROM product WHERE product_id=?";
            PreparedStatement ps = con.prepareStatement(sql);
            Scanner sc = new Scanner(System.in);

            System.out.print("Enter Product ID to delete: ");
            ps.setInt(1, sc.nextInt());

            ps.executeUpdate();
            System.out.println("Product deleted successfully!");

        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
